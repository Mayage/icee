# **********************************************************************
#
# Copyright (c) 2003-2016 ZeroC, Inc. All rights reserved.
#
# This copy of Ice is licensed to you under the terms described in the
# ICE_LICENSE file included in this distribution.
#
# **********************************************************************

BUILD                           = $(shell dpkg-architecture -qDEB_BUILD_GNU_TYPE)

ifeq ($(HOST),)
    HOST                        = $(BUILD)
endif

ifeq ($(filter $(HOST),arm-linux-gnueabihf x86_64-linux-gnu),)
    $(error Invalid HOST: `$(HOST)' supported values are: `arm-linux-gnueabihf' and `x86_64-linux-gnu')
endif

LIBPREFIX                       = $(HOST)
OBJPREFIX                       = $(HOST)$(CPP11PREFIX)
icee_libsubdir                  = lib/$(HOST)

#
# If host different than build we are cross compiling
#
ifneq ($(HOST),$(BUILD))
    TARGET_DIST                 ?= jessie

    ifeq ($(filter $(TARGET_DIST),wheezy jessie trusty vivid),)
        $(error Invalid TARGET_DIST: '$(TARGET_DIST)' supported values are: 'wheezy', 'jessie', 'trusty' and 'vivid'))
    endif

    ifeq ($(TARGET_DIST),wheezy)
        GCC_VERSION             = 4.6
    endif

    ifeq ($(TARGET_DIST),jessie)
        GCC_VERSION             = 4.9
    endif

    ifeq ($(TARGET_DIST),trusty)
        GCC_VERSION             = 4.8
    endif

    ifeq ($(TARGET_DIST),vivid)
        GCC_VERSION             = 4.9
    endif

    CC                          = $(HOST)-gcc-$(GCC_VERSION)
    CXX                         = $(HOST)-g++-$(GCC_VERSION)
    STRIP                       = $(HOST)-strip
    AR                          = $(HOST)-ar

    ifeq ($(TARGET_DIST),jessie)
        python_include_dir      = /usr/include/$(PYTHON_DIR)
    else
    ifneq ($(THIRDPARTY_HOME),)
        override CPPFLAGS       += -I$(THIRDPARTY_HOME)/usr/include
        override LDFLAGS        += -L$(THIRDPARTY_HOME)/usr/$(icee_libsubdir) \
                                   -Wl,-rpath-link,$(THIRDPARTY_HOME)/$(icee_libsubdir)
        python_include_dir      = $(THIRDPARTY_HOME)/usr/include/$(PYTHON_DIR)
    endif
    endif
else
    CC                          = gcc
    CXX                         = g++
    AR                          = ar
    STRIP                       = strip
    python_include_dir          = /usr/include/$(PYTHON_DIR)
endif

ifeq ($(prefix),/usr)
    python_install_dir          ?= $(prefix)/lib/$(PYTHON_DIR)/dist-packages
else
    python_install_dir          ?= $(prefix)/python
endif

ice_install_lib_dir = $(prefix)/lib/$(HOST)

ifeq ($(ICE_HOME),)
    SLICE2PY                    = ice/cpp/bin/slice2py
    SLICE2FREEZE                = ice/cpp/bin/slice2freeze
else
    SLICE2PY                    = slice2py
    SLICE2FREEZE                = slice2freeze
endif
