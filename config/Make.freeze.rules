# **********************************************************************
#
# Copyright (c) 2003-2015 ZeroC, Inc. All rights reserved.
#
# This copy of Ice is licensed to you under the terms described in the
# ICE_LICENSE file included in this distribution.
#
# **********************************************************************
LOCAL_FREEZE_HEADER            := $(LOCAL_FREEZE_CLASS).h
LOCAL_FREEZE_SRC               := $(LOCAL_FREEZE_CLASS).cpp

LOCAL_FREEZE_HEADERS           := $(LOCAL_FREEZE_HEADERS) $(LOCAL_FREEZE_HEADER)
LOCAL_FREEZE_SRCS              := $(LOCAL_FREEZE_SRCS) $(LOCAL_FREEZE_SRC)

ifeq ($(LOCAL_SLICE2FREEZEFLAGS),)
	LOCAL_SLICE2FREEZEFLAGS    := $(LOCAL_SLICE2CPPFLAGS)
endif

$(LOCAL_FREEZEOUTPUTDIR)/$(LOCAL_FREEZE_HEADER): LOCAL_FREEZEOUTPUTDIR := $(LOCAL_FREEZEOUTPUTDIR)
$(LOCAL_FREEZEOUTPUTDIR)/$(LOCAL_FREEZE_HEADER): LOCAL_FREEZE_CLASS := $(LOCAL_FREEZE_CLASS)
$(LOCAL_FREEZEOUTPUTDIR)/$(LOCAL_FREEZE_HEADER): LOCAL_FREEZE_DEPS := $(LOCAL_FREEZE_DEPS)
$(LOCAL_FREEZEOUTPUTDIR)/$(LOCAL_FREEZE_HEADER): LOCAL_FREEZE_DICT := $(LOCAL_FREEZE_DICT)
$(LOCAL_FREEZEOUTPUTDIR)/$(LOCAL_FREEZE_HEADER): LOCAL_SLICE2FREEZEFLAGS := $(LOCAL_SLICE2FREEZEFLAGS)

$(LOCAL_FREEZEOUTPUTDIR)/$(LOCAL_FREEZE_HEADER):: $(LOCAL_FREEZED_DEPS)
	rm -f $(LOCAL_PATH)/$(LOCAL_FREEZE_CLASS).cpp $(LOCAL_FREEZEOUTPUTDIR)/$(LOCAL_FREEZE_CLASS).h
	$(E) "Compiling Freeze $(LOCAL_FREEZE_CLASS)"
	$(Q)LD_LIBRARY_PATH=$(ice_lib_dir):$$LD_LIBRARY_PATH $(SLICE2FREEZE) --output-dir $(@D) \
		$(LOCAL_SLICE2FREEZEFLAGS) $(SLICE2CPPFLAGS) \
		--dict $(LOCAL_FREEZE_DICT)

ifneq ($(LOCAL_FREEZEOUTPUTDIR),$(LOCAL_PATH))
		$(Q)mv $(@D)/$(basename $(@F)).cpp $(LOCAL_PATH)
endif

$(LOCAL_PATH)/$(LOCAL_FREEZE_SRC): $(LOCAL_FREEZEOUTPUTDIR)/$(LOCAL_FREEZE_HEADER)
