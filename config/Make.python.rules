# **********************************************************************
#
# Copyright (c) 2003-2015 ZeroC, Inc. All rights reserved.
#
# This copy of Ice is licensed to you under the terms described in the
# ICE_LICENSE file included in this distribution.
#
# **********************************************************************

LOCAL_GEN_SRCS                  := $(addprefix $(LOCAL_PATH)/$(LOCAL_PREFIX),$(notdir $(LOCAL_SLICES:.ice=.py)))

TARGETS                         := $(TARGETS) $(LOCAL_GEN_SRCS)


$(LOCAL_GEN_SRCS): LOCAL_PREFIX := $(LOCAL_PREFIX)
$(LOCAL_GEN_SRCS): LOCAL_PREFIX := $(LOCAL_PATH)
$(LOCAL_GEN_SRCS): LOCAL_PREFIX := $(LOCAL_SLICEDIR)

$(LOCAL_PATH)/$(LOCAL_PREFIX)%.py: $(LOCAL_SLICEDIR)/%.ice
	@mkdir -p $(@D)/.depend
	$(E) "Compiling $(<F) -> $(@F)"
	$(Q)$(SLICE2PY) --output-dir $(@D) $(LOCAL_SLICE2PYFLAGS) $(SLICE2PYFLAGS) $<
	@$(SLICE2PY) --depend $(LOCAL_SLICE2PYFLAGS) $(SLICE2PYFLAGS) $< | sed 's|\(.*:\)|$(@D)/\1|' > $(@D)/.depend/$(*F).ice.d