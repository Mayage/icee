
include $(OBJECT_RULES)

ifneq ($(LOCAL_LINK_WITH),)
LOCAL_LDFLAGS += $(addprefix -l,$(LOCAL_LINK_WITH))
endif

ifeq ($(LOCAL_BINDIR),)
LOCAL_BINDIR	= $(bindir)
endif

$(LOCAL_MODULE): LOCAL_BINDIR := $(LOCAL_BINDIR)
$(LOCAL_MODULE): LOCAL_EXE := $(LOCAL_EXE)


$(LOCAL_BINDIR)/$(LOCAL_EXE): LOCAL_MODULE := $(LOCAL_MODULE)
$(LOCAL_BINDIR)/$(LOCAL_EXE): LOCAL_BINDIR := $(LOCAL_BINDIR)
$(LOCAL_BINDIR)/$(LOCAL_EXE): LOCAL_EXE := $(LOCAL_EXE)
$(LOCAL_BINDIR)/$(LOCAL_EXE): LOCAL_OBJS := $(LOCAL_OBJS)
$(LOCAL_BINDIR)/$(LOCAL_EXE): LOCAL_LINK_WITH := $(LOCAL_LINK_WITH)
$(LOCAL_BINDIR)/$(LOCAL_EXE): LOCAL_LDFLAGS := $(LOCAL_LDFLAGS)

$(LOCAL_MODULE)_clean: LOCAL_OBJS := $(LOCAL_OBJS)
$(LOCAL_MODULE)_clean: LOCAL_EXE := $(LOCAL_EXE)
$(LOCAL_MODULE)_clean: LOCAL_BINDIR := $(LOCAL_BINDIR)

$(LOCAL_BINDIR)/$(LOCAL_EXE): $(LOCAL_OBJS) $(foreach lib,$(LOCAL_LINK_WITH),$(libdir)/lib$(lib).a)
	@mkdir -p $(@D)
	$(E) "Linking $(LOCAL_MODULE)"
	$(Q)$(CXX) -o $(@) $(LOCAL_OBJS) $(LOCAL_LDFLAGS) $(LDFLAGS)

$(LOCAL_MODULE): $(LOCAL_BINDIR)/$(LOCAL_EXE)


$(LOCAL_MODULE)_clean::
	$(Q)rm -rf $(LOCAL_BINDIR)/$(LOCAL_EXE)

TARGETS := $(TARGETS) $(LOCAL_BINDIR)/$(LOCAL_EXE)